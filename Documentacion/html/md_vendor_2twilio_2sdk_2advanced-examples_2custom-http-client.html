<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SISTEMA_SOLAR_STEM: Custom HTTP Clients for the Twilio PHP Helper Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SISTEMA_SOLAR_STEM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_vendor_2twilio_2sdk_2advanced-examples_2custom-http-client.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Custom HTTP Clients for the Twilio PHP Helper Library </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md39"></a></p>
<p>If you are working with the <a class="el" href="namespace_twilio.html">Twilio</a> PHP Helper Library and need to modify the HTTP requests that the library makes to the <a class="el" href="namespace_twilio.html">Twilio</a> servers you’re in the right place. The most common place you'll need to alter the HTTP request is to connect and authenticate with an enterprise’s proxy server. We’ll provide sample code that you can drop right into your app to handle this use case.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md40"></a>
Connect and authenticate with a proxy server</h1>
<p>To connect and provide credentials to a proxy server between your app and <a class="el" href="namespace_twilio.html">Twilio</a>, you need a way to modify the HTTP requests that the <a class="el" href="namespace_twilio.html">Twilio</a> helper library makes to invoke the <a class="el" href="namespace_twilio.html">Twilio</a> REST API.</p>
<p>In PHP, the <a class="el" href="namespace_twilio.html">Twilio</a> helper library uses the <a href="http://php.net/manual/en/book.curl.php">cURL</a> library under the hood to make HTTP requests. The <a class="el" href="namespace_twilio.html">Twilio</a> Helper Library allows you to provide your own <span class="tt"><a class="el" href="class_http_client.html">HttpClient</a></span> for making API requests.</p>
<p>How do we apply this to a typical <a class="el" href="namespace_twilio.html">Twilio</a> REST API example?</p>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line"> </div>
<div class="line">$twilio = <span class="keyword">new</span> Client($sid, $token);</div>
<div class="line"> </div>
<div class="line">$message = $twilio-&gt;messages</div>
<div class="line">    -&gt;create(</div>
<div class="line">        <span class="stringliteral">&quot;+15558675310&quot;</span>,</div>
<div class="line">        array(</div>
<div class="line">            <span class="stringliteral">&#39;body&#39;</span> =&gt; <span class="stringliteral">&quot;Hey there!&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;from&#39;</span> =&gt; <span class="stringliteral">&quot;+15017122661&quot;</span></div>
<div class="line">        )</div>
<div class="line">    );</div>
</div><!-- fragment --><p>Where does <span class="tt"><a class="el" href="class_http_client.html">HttpClient</a></span> get created and used?</p>
<p>Out of the box, the helper library is creating a default <span class="tt">RequestClient</span> for you, using the <a class="el" href="namespace_twilio.html">Twilio</a> credentials you pass to the <span class="tt">init</span> method. However, there’s nothing stopping you from creating your own <span class="tt">RequestClient</span>.</p>
<p>Once you have your own <span class="tt">RequestClient</span>, you can pass it to any <a class="el" href="namespace_twilio.html">Twilio</a> REST API resource action you want. Here’s an example of sending an SMS message with a custom client:</p>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line"><span class="comment">// Update the path below to your autoload.php,</span></div>
<div class="line"><span class="comment">// see https://getcomposer.org/doc/01-basic-usage.md</span></div>
<div class="line">require_once <span class="stringliteral">&quot;./vendor/autoload.php&quot;</span>;</div>
<div class="line">require_once <span class="stringliteral">&quot;./MyRequestClass.php&quot;</span>;</div>
<div class="line"> </div>
<div class="line">$dotenv = <span class="keyword">new</span> Dotenv\Dotenv(__DIR__);</div>
<div class="line">$dotenv-&gt;load();</div>
<div class="line"> </div>
<div class="line">use <a class="code hl_class" href="class_twilio_1_1_rest_1_1_client.html">Twilio\Rest\Client</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Your Account Sid and Auth Token from twilio.com/console</span></div>
<div class="line">$sid = getenv(<span class="stringliteral">&#39;ACCOUNT_SID&#39;</span>);</div>
<div class="line">$token = getenv(<span class="stringliteral">&#39;AUTH_TOKEN&#39;</span>);</div>
<div class="line">$proxy = getenv(<span class="stringliteral">&#39;PROXY&#39;</span>);</div>
<div class="line"> </div>
<div class="line">$httpClient = <span class="keyword">new</span> MyRequestClass($proxy);</div>
<div class="line">$twilio = <span class="keyword">new</span> Client($sid, $token, <span class="keyword">null</span>, <span class="keyword">null</span>, $httpClient);</div>
<div class="line"> </div>
<div class="line">$message = $twilio-&gt;messages</div>
<div class="line">    -&gt;create(</div>
<div class="line">        <span class="stringliteral">&quot;+15558675310&quot;</span>,</div>
<div class="line">        array(</div>
<div class="line">            <span class="stringliteral">&#39;body&#39;</span> =&gt; <span class="stringliteral">&quot;Hey there!&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;from&#39;</span> =&gt; <span class="stringliteral">&quot;+15017122661&quot;</span></div>
<div class="line">        )</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&quot;Message SID: {$message-&gt;sid}&quot;</span>);</div>
<div class="ttc" id="aclass_twilio_1_1_rest_1_1_client_html"><div class="ttname"><a href="class_twilio_1_1_rest_1_1_client.html">Twilio\Rest\Client</a></div><div class="ttdef"><b>Definition</b> Client.php:102</div></div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md41"></a>
Call Twilio through a proxy server</h1>
<p>Now that we understand how all the components fit together we can create our own <span class="tt"><a class="el" href="class_http_client.html">HttpClient</a></span> that can connect through a proxy server. To make this reusable, here’s a class that you can use to create this <span class="tt"><a class="el" href="class_http_client.html">HttpClient</a></span> whenever you need one.</p>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line"> </div>
<div class="line">use <a class="code hl_class" href="class_twilio_1_1_http_1_1_curl_client.html">Twilio\Http\CurlClient</a>;</div>
<div class="line">use <a class="code hl_class" href="class_twilio_1_1_http_1_1_response.html">Twilio\Http\Response</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MyRequestClass <span class="keyword">extends</span> CurlClient</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">protected</span> $http = <span class="keyword">null</span>;</div>
<div class="line">    <span class="keyword">protected</span> $proxy = <span class="keyword">null</span>;</div>
<div class="line"> </div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> __construct($proxy = <span class="keyword">null</span>, $cainfo = <span class="keyword">null</span>)</div>
<div class="line">    {</div>
<div class="line">        $this-&gt;proxy = $proxy;</div>
<div class="line">        $this-&gt;cainfo = $cainfo;</div>
<div class="line">        $this-&gt;http = <span class="keyword">new</span> CurlClient();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> request(</div>
<div class="line">        $method,</div>
<div class="line">        $url,</div>
<div class="line">        $params = array(), $data = array(), $headers = array(), $user = <span class="keyword">null</span>, $password = <span class="keyword">null</span>, $timeout = <span class="keyword">null</span>): Response</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Here you can change the URL, headers and other request parameters</span></div>
<div class="line">        $options = $this-&gt;options(</div>
<div class="line">            $method,</div>
<div class="line">            $url,</div>
<div class="line">            $params,</div>
<div class="line">            $data,</div>
<div class="line">            $headers,</div>
<div class="line">            $user,</div>
<div class="line">            $password,</div>
<div class="line">            $timeout</div>
<div class="line">        );</div>
<div class="line"> </div>
<div class="line">        $curl = curl_init($url);</div>
<div class="line">        curl_setopt_array($curl, $options);</div>
<div class="line">        <span class="keywordflow">if</span> (!empty($this-&gt;proxy))</div>
<div class="line">            curl_setopt($curl, CURLOPT_PROXY, $this-&gt;proxy);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!empty($this-&gt;cainfo))</div>
<div class="line">            curl_setopt($curl, CURLOPT_CAINFO, $this-&gt;cainfo);</div>
<div class="line">        curl_setopt($curl, CURLOPT_FOLLOWLOCATION, <span class="keyword">true</span>);</div>
<div class="line">        curl_setopt($curl, CURLOPT_RETURNTRANSFER, <span class="keyword">true</span>);</div>
<div class="line">        curl_setopt($curl, CURLOPT_HEADER, <span class="keyword">true</span>);</div>
<div class="line">        curl_setopt($curl, CURLOPT_HTTPPROXYTUNNEL, <span class="keyword">true</span>);</div>
<div class="line">        $response = curl_exec($curl);</div>
<div class="line"> </div>
<div class="line">        $statusCode = curl_getinfo($curl, CURLINFO_HTTP_CODE);</div>
<div class="line">        $headerSize = curl_getinfo($curl, CURLINFO_HEADER_SIZE);</div>
<div class="line">        $head = substr($response, 0, $headerSize);</div>
<div class="line">        $body = substr($response, $headerSize);</div>
<div class="line"> </div>
<div class="line">        $responseHeaders = array();</div>
<div class="line">        $headerLines = preg_split(<span class="stringliteral">&quot;/\r?\n/&quot;</span>, $head);</div>
<div class="line">        <span class="keywordflow">foreach</span> ($headerLines as $line) {</div>
<div class="line">            <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&quot;/:/&quot;</span>, $line))</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            list($key, $value) = explode(<span class="charliteral">&#39;:&#39;</span>, $line, 2);</div>
<div class="line">            $responseHeaders[trim($key)] = trim($value);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        curl_close($curl);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (isset($buffer) &amp;&amp; is_resource($buffer)) {</div>
<div class="line">            fclose($buffer);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> Response($statusCode, $body, $responseHeaders);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclass_twilio_1_1_http_1_1_curl_client_html"><div class="ttname"><a href="class_twilio_1_1_http_1_1_curl_client.html">Twilio\Http\CurlClient</a></div><div class="ttdef"><b>Definition</b> CurlClient.php:11</div></div>
<div class="ttc" id="aclass_twilio_1_1_http_1_1_response_html"><div class="ttname"><a href="class_twilio_1_1_http_1_1_response.html">Twilio\Http\Response</a></div><div class="ttdef"><b>Definition</b> Response.php:7</div></div>
</div><!-- fragment --><p>In this example, we are using some environment variables loaded at the program startup to retrieve various configuration settings:</p>
<ul>
<li>Your <a class="el" href="namespace_twilio.html">Twilio</a> Account Sid and Auth Token (<a href="https://console.twilio.com">found here, in the Twilio console</a>)</li>
<li>A proxy address in IP:Port form, e.g. <span class="tt">127.0.0.1:8888</span></li>
</ul>
<p>Place these setting in an <span class="tt">.env</span> file like so:</p>
<div class="fragment"><div class="line">ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</div>
<div class="line">AUTH_TOKEN= your_auth_token</div>
<div class="line"> </div>
<div class="line">PROXY=127.0.0.1:8888</div>
</div><!-- fragment --><p>Here’s the full console program that loads the <span class="tt">.env</span> file and sends a text message to show everything fitting together.</p>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line"><span class="comment">// Update the path below to your autoload.php,</span></div>
<div class="line"><span class="comment">// see https://getcomposer.org/doc/01-basic-usage.md</span></div>
<div class="line">require_once <span class="stringliteral">&quot;./vendor/autoload.php&quot;</span>;</div>
<div class="line">require_once <span class="stringliteral">&quot;./MyRequestClass.php&quot;</span>;</div>
<div class="line"> </div>
<div class="line">$dotenv = <span class="keyword">new</span> Dotenv\Dotenv(__DIR__);</div>
<div class="line">$dotenv-&gt;load();</div>
<div class="line"> </div>
<div class="line">use <a class="code hl_class" href="class_twilio_1_1_rest_1_1_client.html">Twilio\Rest\Client</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Your Account Sid and Auth Token from twilio.com/console</span></div>
<div class="line">$sid = getenv(<span class="stringliteral">&#39;ACCOUNT_SID&#39;</span>);</div>
<div class="line">$token = getenv(<span class="stringliteral">&#39;AUTH_TOKEN&#39;</span>);</div>
<div class="line">$proxy = getenv(<span class="stringliteral">&#39;PROXY&#39;</span>);</div>
<div class="line"> </div>
<div class="line">$httpClient = <span class="keyword">new</span> MyRequestClass($proxy);</div>
<div class="line">$twilio = <span class="keyword">new</span> Client($sid, $token, <span class="keyword">null</span>, <span class="keyword">null</span>, $httpClient);</div>
<div class="line"> </div>
<div class="line">$message = $twilio-&gt;messages</div>
<div class="line">    -&gt;create(</div>
<div class="line">        <span class="stringliteral">&quot;+15558675310&quot;</span>,</div>
<div class="line">        array(</div>
<div class="line">            <span class="stringliteral">&#39;body&#39;</span> =&gt; <span class="stringliteral">&quot;Hey there!&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;from&#39;</span> =&gt; <span class="stringliteral">&quot;+15017122661&quot;</span></div>
<div class="line">        )</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&quot;Message SID: {$message-&gt;sid}&quot;</span>);</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md42"></a>
What else can this technique be used for?</h1>
<p>Now that you know how to inject your own httpClient into the <a class="el" href="namespace_twilio.html">Twilio</a> API request pipeline, you could use this technique to add custom HTTP headers and authorization to the requests (perhaps as required by an upstream proxy server).</p>
<p>You could also implement your own httpClient to mock the <a class="el" href="namespace_twilio.html">Twilio</a> API responses so your unit and integration tests can run without the need to make a connection to <a class="el" href="namespace_twilio.html">Twilio</a>. In fact, there’s already an example online showing <a href="https://www.twilio.com/docs/openapi/mock-api-generation-with-twilio-openapi-spec">how to do exactly that with Node.js and Prism</a>.</p>
<p>We can’t wait to see what you build! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
